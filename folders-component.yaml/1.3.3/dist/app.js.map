{"version":3,"sources":["app.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","ComponentManager","permissions","onReady","sentMessages","messageQueue","loggingEnabled","acceptsThemes","activeThemes","initialPermissions","onReadyCallback","coallesedSaving","coallesedSavingDelay","registerMessageHandler","value","_this","messageHandler","event","console","log","data","origin","parsedData","JSON","parse","handleMessage","document","addEventListener","window","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","alert","callback","environment","platform","uuid","isMobile","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","return","activeThemeUrls","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","stringify","parent","setSize","type","width","height","bind","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","createItems","_this2","mapped","map","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","sendCustomEvent","saveItem","skipDebouncer","arguments","saveItems","saveItemWithPresave","presave","saveItemsWithPresave","_this3","saveBlock","itemsToSave","mappedItems","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","updated_at","Date","pendingSaveItems","pendingSave","clearTimeout","incomingIds","includes","concat","setTimeout","copy","assign","children","getItemAppDataValue","AppDomain","content","appData","incomingUrls","sort","toString","themesToActivate","themesToDeactivate","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","activeUrl","candidate","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","theme","deactivateTheme","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5","url","link","createElement","id","btoa","href","rel","media","className","getElementsByTagName","appendChild","themeElementForUrl","elements","from","getElementsByClassName","slice","find","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","d","getTime","performance","now","Math","random","floor","module","exports","SNTheme","SNSmartTag","SNServerExtension","SNMfa","SNEncryptedStorage","SNTag","SNNote","SNExtension","Action","SNEditor","SNComponent","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","getPrototypeOf","getter","call","_standardFileJs","require","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_SFItem","json_obj","disassociatedItemIds","associatedItemIds","mapContentToLocalProperties","hosted_url","legacy_url","local_url","offlineOnly","valid_until","name","autoupdateDisabled","package_info","area","active","handleDeletedContent","structureParams","superParams","isEditor","isTheme","isDefaultEditor","getAppDataItem","setLastSize","size","setAppDataItem","getLastSize","getClientDataKey","hasValidHostedUrl","keysToIgnoreWhenCheckingContentEquality","isAssociative","Component","associativeAreas","associateWithItem","isExplicitlyEnabledForItem","indexOf","isExplicitlyDisabledForItem","SFItem","_SFItem2","notes","default","systemEditor","referenceParams","references","_","note","addItemAsRelationship","removeItemAsRelationship","pull","removeAndDirtyAllRelationships","removeReferencesNotPresentIn","uuids","ref","forEach","remove","potentialItemOfInterestHasChangedItsUUID","newItem","oldUUID","newUUID","setData","dataHasChanged","dataForKey","json","merge","running","error","lastExecuted","_SFItem3","actions","actionsWithContextForItem","context","description","supported_types","a","omit","_SFItem4","_this4","text","tags","title","setIsBeingReferencedBy","clearSavedTagsString","setIsNoLongerBeingReferencedBy","isBeingRemovedLocally","tag","informReferencesOfUUIDChange","tagDidFinishSyncing","safeText","safeTitle","savedTagsString","tagsString","arrayToDisplayString","filterDummyNotes","filtered","dummy","_SFItem5","_this5","updateLocalRelationships","_this6","didFinishSyncing","isSmartTag","b","join","_SFItem6","apply","storage","_SFItem7","doNotEncrypt","_SFItem8","_SNTag","json_ob","_this10","systemSmartTags","SystemSmartTagIdAllNotes","isSystemTag","isAllTag","predicate","SFPredicate","fromArray","SystemSmartTagIdArchivedNotes","isArchiveTag","SystemSmartTagIdTrashedNotes","isTrashTag","_SNComponent","_this11","isLayerable","layerable","setMobileRules","rules","getMobileRules","constants","hasMobileRules","setNotAvailOnMobile","na","getNotAvailOnMobile","setMobileActive","isMobileActive","e","angular","HomeCtrl","$rootScope","$scope","$timeout","smartTagContentType","componentManager","delimiter","resolveRawTags","masterTag","sortTags","resolved","rawTags","findResolvedTag","pendingDummy","unshift","comps","split","displayTitle","getParent","depth","parentTitle","tagTitle","index","splice","selectedTag","setSelectedForTag","changeParent","sourceId","targetId","source","needsSave","adjustChildren","child","newTitle","master","createTag","startsWith","components","substring","smartTag","keypath","operator","createdTag","selectOnLoad","selectTag","multiSelect","clearMultipleTagsSelection","multipleTags","smartMaster","createEphemeralSmartTagForMultiTags","editing","tagNames","toggleCollapse","clientData","collapsed","saveTags","selected","newTags","allTags","smartTags","smartMasterTag","arrayToUse","existing","tagCandidate","deleted","deleteTag","deleteChain","addChildren","$$ngIsClass","controller","directive","restrict","scope","shouldFocus","$element","focus","tagId","drop","isDraggable","isDroppable","attrs","el","draggable","counter","dataTransfer","effectAllowed","classList","add","dropEffect","preventDefault","stopPropagation","getData","$apply","TagTree","templateUrl","onSelect","onToggleCollapse","onDrop","onDragOver","onDragStart","ctrlKey","metaKey","addChild","$event","addingTag","saveNewTag","removeTag","innerCollapse","saveTagRename","renameChildren","generationForTag","generation","circleClassForTag","gen","circleClass"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ComponentManager = function () {\n  function ComponentManager(permissions, onReady) {\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.activeThemes = [];\n\n    this.initialPermissions = permissions;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    this.registerMessageHandler();\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"registerMessageHandler\",\n    value: function registerMessageHandler() {\n      var _this = this;\n\n      var messageHandler = function messageHandler(event) {\n        if (_this.loggingEnabled) {\n          console.log(\"Components API Message received:\", event.data);\n        }\n\n        // The first message will be the most reliable one, so we won't change it after any subsequent events,\n        // in case you receive an event from another window.\n        if (!_this.origin) {\n          _this.origin = event.origin;\n        }\n\n        // Mobile environment sends data as JSON string\n        var data = event.data;\n        var parsedData = typeof data === \"string\" ? JSON.parse(data) : data;\n        _this.handleMessage(parsedData);\n      };\n\n      /*\n        Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n        for postMessage API to work properly.\n         Update May 2019:\n        As part of transitioning React Native webview into the community package,\n        we'll now only need to use window.addEventListener.\n         However, we want to maintain backward compatibility for Mobile < v3.0.5, so we'll keep document.addEventListener\n         Also, even with the new version of react-native-webview, Android may still require document.addEventListener (while iOS still only requires window.addEventListener)\n        https://github.com/react-native-community/react-native-webview/issues/323#issuecomment-467767933\n       */\n\n      document.addEventListener(\"message\", function (event) {\n        messageHandler(event);\n      }, false);\n\n      window.addEventListener(\"message\", function (event) {\n        messageHandler(event);\n      }, false);\n    }\n  }, {\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (!originalMessage) {\n          // Connection must have been reset. Alert the user.\n          alert(\"This extension is attempting to communicate with Standard Notes, but an error is preventing it from doing so. Please restart this extension and try again.\");\n        }\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      this.environment = data.environment;\n      this.platform = data.platform;\n      this.uuid = data.uuid;\n      this.isMobile = this.environment == \"mobile\";\n\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n\n      if (this.loggingEnabled) {\n        console.log(\"onReadyData\", data);\n      }\n\n      this.activateThemes(data.activeThemeUrls || []);\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage);\n\n      // Mobile (React Native) requires a string for the postMessage API.\n      if (this.isMobile) {\n        message = JSON.stringify(message);\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, this.origin);\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", { type: type, width: width, height: height }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", { permissions: permissions }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n      this.postMessage(\"stream-items\", { content_types: contentTypes }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          When an item is saved via saveItem, its updated_at value is set client side to the current date.\n          If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n          we want to ignore that change if it was made prior to the latest change we've made.\n           Update 1/22/18: However, if a user is restoring a note from version history, this change\n          will not pass through this filter and will thus be ignored. Because the client now handles\n          this case with isMetadataUpdate, we no longer need the below.\n        */\n        // if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n        //   && this.streamedContextItem.updated_at > item.updated_at) {\n        //   return;\n        // }\n        // this.streamedContextItem = item;\n        callback(item);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", { item: this.jsonObjectForItem(item) }, function (data) {\n        var item = data.item;\n\n        // A previous version of the SN app had an issue where the item in the reply to create-item\n        // would be nested inside \"items\" and not \"item\". So handle both cases here.\n        if (!item && data.items && data.items.length > 0) {\n          item = data.items[0];\n        }\n\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"createItems\",\n    value: function createItems(items, callback) {\n      var _this2 = this;\n\n      var mapped = items.map(function (item) {\n        return _this2.jsonObjectForItem(item);\n      });\n      this.postMessage(\"create-items\", { items: mapped }, function (data) {\n        callback && callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", { content_type: \"Tag\" });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item, callback) {\n      this.deleteItems([item], callback);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items, callback) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n\n      this.postMessage(\"delete-items\", params, function (data) {\n        callback && callback(data);\n      });\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      this.saveItems([item], callback, skipDebouncer);\n    }\n\n    /* Presave allows clients to perform any actions last second before the save actually occurs (like setting previews).\n       Saves debounce by default, so if a client needs to compute a property on an item before saving, it's best to\n       hook into the debounce cycle so that clients don't have to implement their own debouncing.\n     */\n\n  }, {\n    key: \"saveItemWithPresave\",\n    value: function saveItemWithPresave(item, presave, callback) {\n      this.saveItemsWithPresave([item], presave, callback);\n    }\n  }, {\n    key: \"saveItemsWithPresave\",\n    value: function saveItemsWithPresave(items, presave, callback) {\n      this.saveItems(items, callback, false, presave);\n    }\n\n    /*\n    skipDebouncer allows saves to go through right away rather than waiting for timeout.\n    This should be used when saving items via other means besides keystrokes.\n     */\n\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this3 = this;\n\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var presave = arguments[3];\n\n      var saveBlock = function saveBlock(itemsToSave) {\n        // presave block allows client to gain the benefit of performing something in the debounce cycle.\n        presave && presave();\n\n        var mappedItems = [];\n        var _iteratorNormalCompletion2 = true;\n        var _didIteratorError2 = false;\n        var _iteratorError2 = undefined;\n\n        try {\n          for (var _iterator2 = itemsToSave[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n            var item = _step2.value;\n\n            item.updated_at = new Date();\n            mappedItems.push(_this3.jsonObjectForItem(item));\n          }\n        } catch (err) {\n          _didIteratorError2 = true;\n          _iteratorError2 = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion2 && _iterator2.return) {\n              _iterator2.return();\n            }\n          } finally {\n            if (_didIteratorError2) {\n              throw _iteratorError2;\n            }\n          }\n        }\n\n        _this3.postMessage(\"save-items\", { items: mappedItems }, function (data) {\n          callback && callback();\n        });\n      };\n\n      /*\n        Coallesed saving prevents saves from being made after every keystroke, and instead\n        waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n        a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n        save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n        the save will finally trigger.\n         Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n        a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n       */\n\n      // We also need to make sure that when we clear a pending save timeout, we carry over those pending items into the new save.\n      if (!this.pendingSaveItems) {\n        this.pendingSaveItems = [];\n      }\n\n      if (this.coallesedSaving == true && !skipDebouncer) {\n        if (this.pendingSave) {\n          clearTimeout(this.pendingSave);\n        }\n\n        var incomingIds = items.map(function (item) {\n          return item.uuid;\n        });\n\n        // Replace any existing save items with incoming values\n        // Only keep items here who are not in incomingIds\n        this.pendingSaveItems = this.pendingSaveItems.filter(function (item) {\n          return !incomingIds.includes(item.uuid);\n        });\n\n        // Add new items, now that we've made sure it's cleared of incoming items.\n        this.pendingSaveItems = this.pendingSaveItems.concat(items);\n        this.pendingSave = setTimeout(function () {\n          saveBlock(_this3.pendingSaveItems);\n          // Clear pending save items\n          _this3.pendingSaveItems = [];\n        }, this.coallesedSavingDelay);\n      } else {\n        saveBlock(items);\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n  }, {\n    key: \"getItemAppDataValue\",\n    value: function getItemAppDataValue(item, key) {\n      var AppDomain = \"org.standardnotes.sn\";\n      var data = item.content.appData && item.content.appData[AppDomain];\n      if (data) {\n        return data[key];\n      } else {\n        return null;\n      }\n    }\n\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(incomingUrls) {\n      if (this.loggingEnabled) {\n        console.log(\"Incoming themes\", incomingUrls);\n      }\n      if (this.activeThemes.sort().toString() == incomingUrls.sort().toString()) {\n        // incoming are same as active, do nothing\n        return;\n      }\n\n      var themesToActivate = incomingUrls || [];\n      var themesToDeactivate = [];\n\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.activeThemes[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var activeUrl = _step3.value;\n\n          if (!incomingUrls.includes(activeUrl)) {\n            // active not present in incoming, deactivate it\n            themesToDeactivate.push(activeUrl);\n          } else {\n            // already present in active themes, remove it from themesToActivate\n            themesToActivate = themesToActivate.filter(function (candidate) {\n              return candidate != activeUrl;\n            });\n          }\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Deactivating themes:\", themesToDeactivate);\n        console.log(\"Activating themes:\", themesToActivate);\n      }\n\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = themesToDeactivate[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var theme = _step4.value;\n\n          this.deactivateTheme(theme);\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      this.activeThemes = incomingUrls;\n\n      var _iteratorNormalCompletion5 = true;\n      var _didIteratorError5 = false;\n      var _iteratorError5 = undefined;\n\n      try {\n        for (var _iterator5 = themesToActivate[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n          var url = _step5.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.id = btoa(url);\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError5 = true;\n        _iteratorError5 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion5 && _iterator5.return) {\n            _iterator5.return();\n          }\n        } finally {\n          if (_didIteratorError5) {\n            throw _iteratorError5;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"themeElementForUrl\",\n    value: function themeElementForUrl(url) {\n      var elements = Array.from(document.getElementsByClassName(\"custom-theme\")).slice();\n      return elements.find(function (element) {\n        // We used to search here by `href`, but on desktop, with local file:// urls, that didn't work for some reason.\n        return element.id == btoa(url);\n      });\n    }\n  }, {\n    key: \"deactivateTheme\",\n    value: function deactivateTheme(url) {\n      var element = this.themeElementForUrl(url);\n      if (element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    }\n\n    /* Theme caching is currently disabled. Might be enabled in the future if neccessary. */\n    /*\n    activateCachedThemes() {\n      let themes = this.getCachedThemeUrls();\n      let writeToCache = false;\n      if(this.loggingEnabled) { console.log(\"Activating cached themes\", themes); }\n      this.activateThemes(themes, writeToCache);\n    }\n     cacheThemeUrls(urls) {\n      if(this.loggingEnabled) { console.log(\"Caching theme urls\", urls); }\n      localStorage.setItem(\"cachedThemeUrls\", JSON.stringify(urls));\n    }\n     decacheThemeUrls() {\n      localStorage.removeItem(\"cachedThemeUrls\");\n    }\n     getCachedThemeUrls() {\n      let urls = localStorage.getItem(\"cachedThemeUrls\");\n      if(urls) {\n        return JSON.parse(urls);\n      } else {\n        return [];\n      }\n    }\n    */\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n//# sourceMappingURL=dist.js.map\n;\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SNTheme = exports.SNSmartTag = exports.SNServerExtension = exports.SNMfa = exports.SNEncryptedStorage = exports.SNTag = exports.SNNote = exports.SNExtension = exports.Action = exports.SNEditor = exports.SNComponent = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _standardFileJs = require(\"standard-file-js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SNComponent = exports.SNComponent = function (_SFItem) {\n  _inherits(SNComponent, _SFItem);\n\n  function SNComponent(json_obj) {\n    _classCallCheck(this, SNComponent);\n\n    // If making a copy of an existing component (usually during sign in if you have a component active in the session),\n    // which may have window set, you may get a cross-origin exception since you'll be trying to copy the window. So we clear it here.\n    json_obj.window = null;\n\n    var _this = _possibleConstructorReturn(this, (SNComponent.__proto__ || Object.getPrototypeOf(SNComponent)).call(this, json_obj));\n\n    if (!_this.componentData) {\n      _this.componentData = {};\n    }\n\n    if (!_this.disassociatedItemIds) {\n      _this.disassociatedItemIds = [];\n    }\n\n    if (!_this.associatedItemIds) {\n      _this.associatedItemIds = [];\n    }\n    return _this;\n  }\n\n  _createClass(SNComponent, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      /* Legacy */\n      // We don't want to set the url directly, as we'd like to phase it out.\n      // If the content.url exists, we'll transfer it to legacy_url\n      // We'll only need to set this if content.hosted_url is blank, otherwise, hosted_url is the url replacement.\n      if (!content.hosted_url) {\n        this.legacy_url = content.url;\n      }\n\n      /* New */\n      this.local_url = content.local_url;\n      this.hosted_url = content.hosted_url || content.url;\n      this.offlineOnly = content.offlineOnly;\n\n      if (content.valid_until) {\n        this.valid_until = new Date(content.valid_until);\n      }\n\n      this.name = content.name;\n      this.autoupdateDisabled = content.autoupdateDisabled;\n\n      this.package_info = content.package_info;\n\n      // the location in the view this component is located in. Valid values are currently tags-list, note-tags, and editor-stack`\n      this.area = content.area;\n\n      this.permissions = content.permissions;\n      if (!this.permissions) {\n        this.permissions = [];\n      }\n\n      this.active = content.active;\n\n      // custom data that a component can store in itself\n      this.componentData = content.componentData || {};\n\n      // items that have requested a component to be disabled in its context\n      this.disassociatedItemIds = content.disassociatedItemIds || [];\n\n      // items that have requested a component to be enabled in its context\n      this.associatedItemIds = content.associatedItemIds || [];\n    }\n  }, {\n    key: \"handleDeletedContent\",\n    value: function handleDeletedContent() {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"handleDeletedContent\", this).call(this);\n\n      this.active = false;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        legacy_url: this.legacy_url,\n        hosted_url: this.hosted_url,\n        local_url: this.local_url,\n        valid_until: this.valid_until,\n        offlineOnly: this.offlineOnly,\n        name: this.name,\n        area: this.area,\n        package_info: this.package_info,\n        permissions: this.permissions,\n        active: this.active,\n        autoupdateDisabled: this.autoupdateDisabled,\n        componentData: this.componentData,\n        disassociatedItemIds: this.disassociatedItemIds,\n        associatedItemIds: this.associatedItemIds\n      };\n\n      var superParams = _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"isEditor\",\n    value: function isEditor() {\n      return this.area == \"editor-editor\";\n    }\n  }, {\n    key: \"isTheme\",\n    value: function isTheme() {\n      return this.content_type == \"SN|Theme\" || this.area == \"themes\";\n    }\n  }, {\n    key: \"isDefaultEditor\",\n    value: function isDefaultEditor() {\n      return this.getAppDataItem(\"defaultEditor\") == true;\n    }\n  }, {\n    key: \"setLastSize\",\n    value: function setLastSize(size) {\n      this.setAppDataItem(\"lastSize\", size);\n    }\n  }, {\n    key: \"getLastSize\",\n    value: function getLastSize() {\n      return this.getAppDataItem(\"lastSize\");\n    }\n  }, {\n    key: \"acceptsThemes\",\n    value: function acceptsThemes() {\n      if (this.content.package_info && \"acceptsThemes\" in this.content.package_info) {\n        return this.content.package_info.acceptsThemes;\n      }\n      return true;\n    }\n\n    /*\n      The key used to look up data that this component may have saved to an item.\n      This key will be look up on the item, and not on itself.\n     */\n\n  }, {\n    key: \"getClientDataKey\",\n    value: function getClientDataKey() {\n      if (this.legacy_url) {\n        return this.legacy_url;\n      } else {\n        return this.uuid;\n      }\n    }\n  }, {\n    key: \"hasValidHostedUrl\",\n    value: function hasValidHostedUrl() {\n      return this.hosted_url || this.legacy_url;\n    }\n  }, {\n    key: \"keysToIgnoreWhenCheckingContentEquality\",\n    value: function keysToIgnoreWhenCheckingContentEquality() {\n      return [\"active\"].concat(_get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"keysToIgnoreWhenCheckingContentEquality\", this).call(this));\n    }\n\n    /*\n      An associative component depends on being explicitly activated for a given item, compared to a dissaciative component,\n      which is enabled by default in areas unrelated to a certain item.\n     */\n\n  }, {\n    key: \"isAssociative\",\n    value: function isAssociative() {\n      return Component.associativeAreas().includes(this.area);\n    }\n  }, {\n    key: \"associateWithItem\",\n    value: function associateWithItem(item) {\n      this.associatedItemIds.push(item.uuid);\n    }\n  }, {\n    key: \"isExplicitlyEnabledForItem\",\n    value: function isExplicitlyEnabledForItem(item) {\n      return this.associatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"isExplicitlyDisabledForItem\",\n    value: function isExplicitlyDisabledForItem(item) {\n      return this.disassociatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Component\";\n    }\n  }], [{\n    key: \"associativeAreas\",\n    value: function associativeAreas() {\n      return [\"editor-editor\"];\n    }\n  }]);\n\n  return SNComponent;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEditor = exports.SNEditor = function (_SFItem2) {\n  _inherits(SNEditor, _SFItem2);\n\n  function SNEditor(json_obj) {\n    _classCallCheck(this, SNEditor);\n\n    var _this2 = _possibleConstructorReturn(this, (SNEditor.__proto__ || Object.getPrototypeOf(SNEditor)).call(this, json_obj));\n\n    if (!_this2.notes) {\n      _this2.notes = [];\n    }\n    if (!_this2.data) {\n      _this2.data = {};\n    }\n    return _this2;\n  }\n\n  _createClass(SNEditor, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n      this.name = content.name;\n      this.data = content.data || {};\n      this.default = content.default;\n      this.systemEditor = content.systemEditor;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        url: this.url,\n        name: this.name,\n        data: this.data,\n        default: this.default,\n        systemEditor: this.systemEditor\n      };\n\n      var superParams = _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"referenceParams\",\n    value: function referenceParams() {\n      var references = _.map(this.notes, function (note) {\n        return { uuid: note.uuid, content_type: note.content_type };\n      });\n\n      return references;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, item)) {\n          this.notes.push(item);\n        }\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.pull(this.notes, item);\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeAndDirtyAllRelationships\",\n    value: function removeAndDirtyAllRelationships() {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeAndDirtyAllRelationships\", this).call(this);\n      this.notes = [];\n    }\n  }, {\n    key: \"removeReferencesNotPresentIn\",\n    value: function removeReferencesNotPresentIn(references) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeReferencesNotPresentIn\", this).call(this, references);\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(this.notes, { uuid: note.uuid });\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"potentialItemOfInterestHasChangedItsUUID\",\n    value: function potentialItemOfInterestHasChangedItsUUID(newItem, oldUUID, newUUID) {\n      if (newItem.content_type === \"Note\" && _.find(this.notes, { uuid: oldUUID })) {\n        _.remove(this.notes, { uuid: oldUUID });\n        this.notes.push(newItem);\n      }\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(key, value) {\n      var dataHasChanged = JSON.stringify(this.data[key]) !== JSON.stringify(value);\n      if (dataHasChanged) {\n        this.data[key] = value;\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"dataForKey\",\n    value: function dataForKey(key) {\n      return this.data[key] || {};\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Editor\";\n    }\n  }]);\n\n  return SNEditor;\n}(_standardFileJs.SFItem);\n\n;\nvar Action = exports.Action = function Action(json) {\n  _classCallCheck(this, Action);\n\n  _.merge(this, json);\n  this.running = false; // in case running=true was synced with server since model is uploaded nondiscriminatory\n  this.error = false;\n  if (this.lastExecuted) {\n    // is string\n    this.lastExecuted = new Date(this.lastExecuted);\n  }\n};\n\nvar SNExtension = exports.SNExtension = function (_SFItem3) {\n  _inherits(SNExtension, _SFItem3);\n\n  function SNExtension(json) {\n    _classCallCheck(this, SNExtension);\n\n    var _this3 = _possibleConstructorReturn(this, (SNExtension.__proto__ || Object.getPrototypeOf(SNExtension)).call(this, json));\n\n    if (json.actions) {\n      _this3.actions = json.actions.map(function (action) {\n        return new Action(action);\n      });\n    }\n\n    if (!_this3.actions) {\n      _this3.actions = [];\n    }\n    return _this3;\n  }\n\n  _createClass(SNExtension, [{\n    key: \"actionsWithContextForItem\",\n    value: function actionsWithContextForItem(item) {\n      return this.actions.filter(function (action) {\n        return action.context == item.content_type || action.context == \"Item\";\n      });\n    }\n  }, {\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.description = content.description;\n      this.url = content.url;\n      this.name = content.name;\n      this.package_info = content.package_info;\n      this.supported_types = content.supported_types;\n      if (content.actions) {\n        this.actions = content.actions.map(function (action) {\n          return new Action(action);\n        });\n      }\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        name: this.name,\n        url: this.url,\n        package_info: this.package_info,\n        description: this.description,\n        actions: this.actions.map(function (a) {\n          return _.omit(a, [\"subrows\", \"subactions\"]);\n        }),\n        supported_types: this.supported_types\n      };\n\n      var superParams = _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Extension\";\n    }\n  }]);\n\n  return SNExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNNote = exports.SNNote = function (_SFItem4) {\n  _inherits(SNNote, _SFItem4);\n\n  function SNNote(json_obj) {\n    _classCallCheck(this, SNNote);\n\n    var _this4 = _possibleConstructorReturn(this, (SNNote.__proto__ || Object.getPrototypeOf(SNNote)).call(this, json_obj));\n\n    if (!_this4.text) {\n      // Some external editors can't handle a null value for text.\n      // Notes created on mobile with no text have a null value for it,\n      // so we'll just set a default here.\n      _this4.text = \"\";\n    }\n\n    if (!_this4.tags) {\n      _this4.tags = [];\n    }\n    return _this4;\n  }\n\n  _createClass(SNNote, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n      this.text = content.text;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title,\n        text: this.text\n      };\n\n      var superParams = _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      /*\n      Legacy.\n      Previously, note/tag relationships were bidirectional, however in some cases there\n      may be broken links such that a note has references to a tag and not vice versa.\n      Now, only tags contain references to notes. For old notes that may have references to tags,\n      we want to transfer them over to the tag.\n       */\n      if (item.content_type == \"Tag\") {\n        item.addItemAsRelationship(this);\n      }\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"setIsBeingReferencedBy\",\n    value: function setIsBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"setIsNoLongerBeingReferencedBy\",\n    value: function setIsNoLongerBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsNoLongerBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      this.tags.forEach(function (tag) {\n        _.remove(tag.notes, { uuid: this.uuid });\n      }.bind(this));\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"informReferencesOfUUIDChange\", this).call(this);\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.tags[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var tag = _step.value;\n\n          _.remove(tag.notes, { uuid: oldUUID });\n          tag.notes.push(this);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"tagDidFinishSyncing\",\n    value: function tagDidFinishSyncing(tag) {\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"safeText\",\n    value: function safeText() {\n      return this.text || \"\";\n    }\n  }, {\n    key: \"safeTitle\",\n    value: function safeTitle() {\n      return this.title || \"\";\n    }\n  }, {\n    key: \"clearSavedTagsString\",\n    value: function clearSavedTagsString() {\n      this.savedTagsString = null;\n    }\n  }, {\n    key: \"tagsString\",\n    value: function tagsString() {\n      this.savedTagsString = SNTag.arrayToDisplayString(this.tags);\n      return this.savedTagsString;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Note\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Note\";\n    }\n  }], [{\n    key: \"filterDummyNotes\",\n    value: function filterDummyNotes(notes) {\n      var filtered = notes.filter(function (note) {\n        return note.dummy == false || note.dummy == null;\n      });\n      return filtered;\n    }\n  }]);\n\n  return SNNote;\n}(_standardFileJs.SFItem);\n\n;\nvar SNTag = exports.SNTag = function (_SFItem5) {\n  _inherits(SNTag, _SFItem5);\n\n  function SNTag(json_obj) {\n    _classCallCheck(this, SNTag);\n\n    var _this5 = _possibleConstructorReturn(this, (SNTag.__proto__ || Object.getPrototypeOf(SNTag)).call(this, json_obj));\n\n    if (!_this5.content_type) {\n      _this5.content_type = \"Tag\";\n    }\n\n    if (!_this5.notes) {\n      _this5.notes = [];\n    }\n    return _this5;\n  }\n\n  _createClass(SNTag, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title\n      };\n\n      var superParams = _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, { uuid: item.uuid })) {\n          this.notes.push(item);\n          item.tags.push(this);\n        }\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.remove(this.notes, { uuid: item.uuid });\n        _.remove(item.tags, { uuid: this.uuid });\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"updateLocalRelationships\",\n    value: function updateLocalRelationships() {\n      var references = this.content.references;\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.slice().forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(note.tags, { uuid: this.uuid });\n          _.remove(this.notes, { uuid: note.uuid });\n\n          note.setIsNoLongerBeingReferencedBy(this);\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      var _this6 = this;\n\n      this.notes.forEach(function (note) {\n        _.remove(note.tags, { uuid: _this6.uuid });\n        note.setIsNoLongerBeingReferencedBy(_this6);\n      });\n\n      this.notes.length = 0;\n\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.notes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var note = _step2.value;\n\n          _.remove(note.tags, { uuid: oldUUID });\n          note.tags.push(this);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"didFinishSyncing\",\n    value: function didFinishSyncing() {\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.notes[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var note = _step3.value;\n\n          note.tagDidFinishSyncing(this);\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"isSmartTag\",\n    value: function isSmartTag() {\n      return this.content_type == \"SN|SmartTag\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Tag\";\n    }\n  }], [{\n    key: \"arrayToDisplayString\",\n    value: function arrayToDisplayString(tags) {\n      return tags.sort(function (a, b) {\n        return a.title > b.title;\n      }).map(function (tag, i) {\n        return \"#\" + tag.title;\n      }).join(\" \");\n    }\n  }]);\n\n  return SNTag;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEncryptedStorage = exports.SNEncryptedStorage = function (_SFItem6) {\n  _inherits(SNEncryptedStorage, _SFItem6);\n\n  function SNEncryptedStorage() {\n    _classCallCheck(this, SNEncryptedStorage);\n\n    return _possibleConstructorReturn(this, (SNEncryptedStorage.__proto__ || Object.getPrototypeOf(SNEncryptedStorage)).apply(this, arguments));\n  }\n\n  _createClass(SNEncryptedStorage, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEncryptedStorage.prototype.__proto__ || Object.getPrototypeOf(SNEncryptedStorage.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.storage = content.storage;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|EncryptedStorage\";\n    }\n  }]);\n\n  return SNEncryptedStorage;\n}(_standardFileJs.SFItem);\n\n;\nvar SNMfa = exports.SNMfa = function (_SFItem7) {\n  _inherits(SNMfa, _SFItem7);\n\n  function SNMfa(json_obj) {\n    _classCallCheck(this, SNMfa);\n\n    return _possibleConstructorReturn(this, (SNMfa.__proto__ || Object.getPrototypeOf(SNMfa)).call(this, json_obj));\n  }\n\n  // mapContentToLocalProperties(content) {\n  //   super.mapContentToLocalProperties(content)\n  //   this.serverContent = content;\n  // }\n  //\n  // structureParams() {\n  //   return _.merge(this.serverContent, super.structureParams());\n  // }\n\n  _createClass(SNMfa, [{\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|MFA\";\n    }\n  }]);\n\n  return SNMfa;\n}(_standardFileJs.SFItem);\n\n;\nvar SNServerExtension = exports.SNServerExtension = function (_SFItem8) {\n  _inherits(SNServerExtension, _SFItem8);\n\n  function SNServerExtension() {\n    _classCallCheck(this, SNServerExtension);\n\n    return _possibleConstructorReturn(this, (SNServerExtension.__proto__ || Object.getPrototypeOf(SNServerExtension)).apply(this, arguments));\n  }\n\n  _createClass(SNServerExtension, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNServerExtension.prototype.__proto__ || Object.getPrototypeOf(SNServerExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n    }\n  }, {\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|Extension\";\n    }\n  }]);\n\n  return SNServerExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNSmartTag = exports.SNSmartTag = function (_SNTag) {\n  _inherits(SNSmartTag, _SNTag);\n\n  function SNSmartTag(json_ob) {\n    _classCallCheck(this, SNSmartTag);\n\n    var _this10 = _possibleConstructorReturn(this, (SNSmartTag.__proto__ || Object.getPrototypeOf(SNSmartTag)).call(this, json_ob));\n\n    _this10.content_type = \"SN|SmartTag\";\n    return _this10;\n  }\n\n  _createClass(SNSmartTag, null, [{\n    key: \"systemSmartTags\",\n    value: function systemSmartTags() {\n      return [new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdAllNotes,\n        content: {\n          title: \"All notes\",\n          isSystemTag: true,\n          isAllTag: true,\n          predicate: new SFPredicate.fromArray([\"content_type\", \"=\", \"Note\"])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdArchivedNotes,\n        content: {\n          title: \"Archived\",\n          isSystemTag: true,\n          isArchiveTag: true,\n          predicate: new SFPredicate.fromArray([\"archived\", \"=\", true])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdTrashedNotes,\n        content: {\n          title: \"Trash\",\n          isSystemTag: true,\n          isTrashTag: true,\n          predicate: new SFPredicate.fromArray([\"content.trashed\", \"=\", true])\n        }\n      })];\n    }\n  }]);\n\n  return SNSmartTag;\n}(SNTag);\n\nSNSmartTag.SystemSmartTagIdAllNotes = \"all-notes\";\nSNSmartTag.SystemSmartTagIdArchivedNotes = \"archived-notes\";\nSNSmartTag.SystemSmartTagIdTrashedNotes = \"trashed-notes\";\n;\nvar SNTheme = exports.SNTheme = function (_SNComponent) {\n  _inherits(SNTheme, _SNComponent);\n\n  function SNTheme(json_obj) {\n    _classCallCheck(this, SNTheme);\n\n    var _this11 = _possibleConstructorReturn(this, (SNTheme.__proto__ || Object.getPrototypeOf(SNTheme)).call(this, json_obj));\n\n    _this11.area = \"themes\";\n    return _this11;\n  }\n\n  _createClass(SNTheme, [{\n    key: \"isLayerable\",\n    value: function isLayerable() {\n      return this.package_info && this.package_info.layerable;\n    }\n  }, {\n    key: \"setMobileRules\",\n    value: function setMobileRules(rules) {\n      this.setAppDataItem(\"mobileRules\", rules);\n    }\n  }, {\n    key: \"getMobileRules\",\n    value: function getMobileRules() {\n      return this.getAppDataItem(\"mobileRules\") || { constants: {}, rules: {} };\n    }\n\n    // Same as getMobileRules but without default value\n\n  }, {\n    key: \"hasMobileRules\",\n    value: function hasMobileRules() {\n      return this.getAppDataItem(\"mobileRules\");\n    }\n  }, {\n    key: \"setNotAvailOnMobile\",\n    value: function setNotAvailOnMobile(na) {\n      this.setAppDataItem(\"notAvailableOnMobile\", na);\n    }\n  }, {\n    key: \"getNotAvailOnMobile\",\n    value: function getNotAvailOnMobile() {\n      return this.getAppDataItem(\"notAvailableOnMobile\");\n    }\n\n    /* We must not use .active because if you set that to true, it will also activate that theme on desktop/web */\n\n  }, {\n    key: \"setMobileActive\",\n    value: function setMobileActive(active) {\n      this.setAppDataItem(\"mobileActive\", active);\n    }\n  }, {\n    key: \"isMobileActive\",\n    value: function isMobileActive() {\n      return this.getAppDataItem(\"mobileActive\");\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Theme\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Theme\";\n    }\n  }]);\n\n  return SNTheme;\n}(SNComponent);\n\n;\n\nif (typeof window !== 'undefined' && window !== null) {\n  // window is for some reason defined in React Native, but throws an exception when you try to set to it\n  try {\n    window.SNNote = SNNote;\n    window.SNTag = SNTag;\n    window.SNSmartTag = SNSmartTag;\n    window.SNMfa = SNMfa;\n    window.SNServerExtension = SNServerExtension;\n    window.SNComponent = SNComponent;\n    window.SNEditor = SNEditor;\n    window.SNExtension = SNExtension;\n    window.SNTheme = SNTheme;\n    window.SNEncryptedStorage = SNEncryptedStorage;\n  } catch (e) {\n    console.log(\"Exception while exporting sn-models window variables\", e);\n  }\n}\n//# sourceMappingURL=transpiled.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    let smartTagContentType = \"SN|SmartTag\";\n\n    let componentManager = new window.ComponentManager([], () => {\n      // on ready\n      $rootScope.platform = componentManager.platform;\n    });\n\n    let delimiter = \".\";\n\n    $scope.resolveRawTags = function(masterTag) {\n      let sortTags = (tags) => {\n        return tags.sort((a, b) => (a.content.title > b.content.title) - (a.content.title < b.content.title));\n      }\n      var resolved = masterTag.rawTags.slice();\n\n      var findResolvedTag = function(title) {\n        for(var tag of masterTag.rawTags) {\n          if(tag.content.title === title) {\n            return tag;\n          }\n        }\n        return null;\n      }\n\n      for(var tag of masterTag.rawTags) {\n        var pendingDummy = tag.children && tag.children.find((c) => {return c.dummy});\n        tag.children = [];\n        tag.parent = null;\n\n        if(pendingDummy) {\n          tag.children.unshift(pendingDummy);\n        }\n      };\n\n      for(var tag of masterTag.rawTags) {\n        var name = tag.content.title;\n        var comps = name.split(delimiter);\n        tag.displayTitle = comps[comps.length -1];\n        if(comps.length == 1) {\n          tag.parent = masterTag;\n          continue;\n        }\n\n        var getParent = function(depth = 1) {\n          var parentTitle = comps.slice(0, comps.length - depth).join(delimiter);\n          if(parentTitle.length == 0) {\n            return null;\n          }\n          var parent = findResolvedTag(parentTitle);\n\n          // didn't find parent, try again.\n          // just make sure we're not deeper in search than we can go\n          if(!parent && depth < comps.length - 1) {\n            return getParent(depth + 1);\n          }\n\n          // remove parent from name and keep this full tag name to display\n          var tagTitle = tag.content.title.slice(parentTitle.length+1);\n          tag.displayTitle = tagTitle;\n\n          return parent;\n        };\n\n        var parent = getParent();\n\n        // no parent at all up the tree, fall back to root with full name\n        if(!parent) {\n          tag.displayTitle = tag.content.title;\n          tag.parent = masterTag;\n          continue;\n        }\n\n        parent.children.push(tag);\n        parent.children = sortTags(parent.children);\n        tag.parent = parent;\n\n        // remove chid from master list\n        var index = resolved.indexOf(tag);\n        resolved.splice(index, 1);\n\n        if($scope.selectedTag && $scope.selectedTag.uuid == tag.uuid) {\n          $scope.selectedTag = tag;\n          $scope.setSelectedForTag(tag, true);\n        }\n      }\n\n      var pendingDummy = masterTag.children && masterTag.children.find((c) => {return c.dummy});\n      masterTag.children = sortTags(resolved);\n      if(pendingDummy) { masterTag.children.unshift(pendingDummy); }\n    }\n\n    $scope.changeParent = function(sourceId, targetId) {\n      var source = $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === sourceId;\n      })[0];\n\n      var target = targetId === \"0\" ? $scope.masterTag : $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === targetId;\n      })[0];\n\n      if(target.parent === source) {\n        return;\n      }\n\n      var needsSave = [source];\n\n      var adjustChildren = function(source) {\n        for(var child of source.children) {\n          var newTitle = source.content.title + delimiter + child.content.title.split(delimiter).slice(-1)[0];\n          child.content.title = newTitle;\n          needsSave.push(child);\n          adjustChildren(child);\n        }\n      }\n\n      var newTitle;\n      if(target.master) {\n        newTitle = source.content.title.split(delimiter).slice(-1)[0];\n      } else {\n        newTitle = target.content.title + delimiter + source.content.title.split(delimiter).slice(-1)[0];\n      }\n      source.content.title = newTitle;\n      adjustChildren(source);\n      $scope.resolveRawTags($scope.masterTag);\n\n      componentManager.saveItems(needsSave);\n    }\n\n    $scope.createTag = function(tag) {\n      var title = tag.content.title;\n      if(title.startsWith(\"![\")) {\n        /*\n        Create smart tag. Examples:\n        ![\"Not Pinned\", \"pinned\", \"=\", false]\n        ![\"Last Day\", \"updated_at\", \">\", \"1.days.ago\"]\n        ![\"Long\", \"text.length\", \">\", 500]\n        */\n        try {\n          var components = JSON.parse(title.substring(1, title.length));\n        } catch (e) {\n          alert(\"There was an error parsing your smart tag syntax. Please ensure the value after the exclamation mark is valid JSON, and try again.\")\n          return;\n        }\n        var smartTag = {\n          content_type: smartTagContentType,\n          content: {\n            title: components[0],\n            predicate: {\n              keypath: components[1],\n              operator: components[2],\n              value: components[3]\n            }\n          }\n        }\n        componentManager.createItem(smartTag, (createdTag) => {\n          // We don't want to select the tag right away because it hasn't been added yet.\n          // If you do $scope.selectTag(createdTag), an issue occurs where selecting another tag\n          // after that will not dehighlight this one.\n          $scope.selectOnLoad = createdTag;\n        });\n      } else {\n        tag.content_type = \"Tag\";\n        var title;\n        if(tag.parent.master) {\n          title = tag.content.title;\n        } else {\n          title = tag.parent.content.title + delimiter + tag.content.title;\n        }\n        tag.content.title = title;\n        tag.dummy = false;\n        componentManager.createItem(tag, (createdTag) => {\n          $scope.selectOnLoad = createdTag;\n        });\n      }\n    }\n\n    $scope.selectTag = function(tag, multiSelect) {\n      let isSmartTag = tag.content_type == smartTagContentType;\n      // Multi selection for smart tags is not possible.\n      if(isSmartTag) {\n        multiSelect = false;\n      }\n\n      let clearMultipleTagsSelection = function() {\n        if($scope.multipleTags) {\n          for(var selectedTag of $scope.multipleTags) {\n            $scope.setSelectedForTag(selectedTag, false);\n          }\n        }\n      }\n\n      if(tag.master || tag.smartMaster) {\n        clearMultipleTagsSelection();\n        $scope.multipleTags = [];\n        componentManager.clearSelection();\n      } else {\n        if(!$scope.multipleTags) { $scope.multipleTags = []; }\n        if(!isSmartTag) {\n          $scope.multipleTags.push(tag);\n        }\n        if(multiSelect && $scope.multipleTags.length > 1) {\n          var smartTag = $scope.createEphemeralSmartTagForMultiTags();\n          componentManager.selectItem(smartTag);\n        } else {\n          clearMultipleTagsSelection();\n          $scope.multipleTags = isSmartTag ? [] : [tag];\n          componentManager.selectItem(tag);\n        }\n      }\n\n      // if multiselect, we don't want to clear selected tag. But if master is selected,\n      // and multi select other tag, we do want to clear master. Rather than creating a large if\n      // statement, we'll just an if else.\n\n      if(!multiSelect && $scope.selectedTag && $scope.selectedTag != tag) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n        $scope.selectedTag.editing = false;\n      } else if($scope.selectedTag.master || $scope.selectedTag.smartMaster || $scope.selectedTag.content_type == smartTagContentType) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n      }\n\n      if($scope.selectedTag === tag && !tag.master && !tag.content.isSystemTag) {\n        tag.editing = true;\n      }\n\n      $scope.selectedTag = tag;\n      $scope.setSelectedForTag(tag, true);\n    }\n\n    $scope.createEphemeralSmartTagForMultiTags = function() {\n      let smartTag = {\n        uuid: Math.random(),\n        content_type: \"SN|SmartTag\",\n        content: {\n          title: \"Multiple tags\"\n        }\n      }\n\n      var tagNames = $scope.multipleTags.map((tag) => {return tag.content.title});\n      var predicate = [\"tags\", \"includes\", [\"title\", \"in\", tagNames]];\n      smartTag.content.predicate = predicate;\n      return smartTag;\n    }\n\n    $scope.toggleCollapse = function(tag) {\n      tag.clientData.collapsed = !tag.clientData.collapsed;\n      if(!tag.master) {\n        componentManager.saveItem(tag);\n      }\n    }\n\n    $scope.saveTags = function(tags) {\n      componentManager.saveItems(tags);\n    }\n\n    $scope.setSelectedForTag = function(tag, selected) {\n      tag.selected = selected;\n    }\n\n    componentManager.streamItems([\"Tag\", smartTagContentType], (newTags) => {\n      $timeout(() => {\n        var allTags = $scope.masterTag ? $scope.masterTag.rawTags : [];\n        var smartTags = $scope.smartMasterTag ? $scope.smartMasterTag.rawTags : SNSmartTag.systemSmartTags();\n        for(var tag of newTags) {\n          var isSmartTag = tag.content_type == smartTagContentType;\n          var arrayToUse = isSmartTag ? smartTags : allTags;\n\n          var existing = arrayToUse.filter((tagCandidate) => {\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n\n          if(existing) {\n            Object.assign(existing, tag);\n          } else if(tag.content.title) {\n            arrayToUse.push(tag);\n          }\n\n          if(tag.deleted) {\n            var index = arrayToUse.indexOf(existing || tag);\n            arrayToUse.splice(index, 1);\n          } else {\n            if($scope.selectOnLoad && $scope.selectOnLoad.uuid == tag.uuid)  {\n              $scope.selectOnLoad = null;\n              $scope.selectTag(tag);\n            } else if(existing && $scope.selectedTag && $scope.selectedTag.uuid == existing.uuid) {\n              // Don't call $scope.selectTag(existing) as this will double select a tag, which will enable editing for it.\n              $scope.setSelectedForTag(existing, true);\n            }\n          }\n        }\n\n        if(!$scope.masterTag) {\n          $scope.masterTag = {\n            master: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"All\",\n            uuid: \"0\",\n            clientData: {}\n          }\n        }\n\n        if(!$scope.smartMasterTag) {\n          $scope.smartMasterTag = {\n            master: true,\n            smartMaster: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"Views\",\n            uuid: \"1\",\n            clientData: {}\n          }\n        }\n\n        $scope.masterTag.rawTags = allTags;\n        $scope.smartMasterTag.rawTags = smartTags;\n\n        if(!$scope.selectedTag || ($scope.selectedTag && $scope.selectedTag.master)) {\n          if($scope.selectedTag && $scope.selectedTag.smartMaster) {\n            $scope.selectedTag = $scope.smartMasterTag;\n            $scope.setSelectedForTag($scope.masterTag, false);\n          } else {\n            $scope.selectedTag = $scope.masterTag;\n            $scope.setSelectedForTag($scope.smartMasterTag, false);\n          }\n          $scope.setSelectedForTag($scope.selectedTag, true);\n        }\n\n        if($scope.selectedTag.deleted) {\n          $scope.selectTag($scope.masterTag);\n        }\n\n        $scope.resolveRawTags($scope.masterTag);\n        $scope.resolveRawTags($scope.smartMasterTag);\n      })\n    });\n\n    $scope.deleteTag = function(tag) {\n      var isSmartTag = tag.content_type == smartTagContentType;\n      var arrayToUse = isSmartTag ? $scope.smartMasterTag.rawTags : $scope.masterTag.rawTags;\n\n      var tag = arrayToUse.filter(function(tagCandidate){\n        return tagCandidate.uuid === tag.uuid;\n      })[0];\n\n      var deleteChain = [];\n\n      function addChildren(tag) {\n        deleteChain.push(tag);\n        if(tag.children) {\n          for(var child of tag.children) {\n            addChildren(child);\n          }\n        }\n      }\n\n      addChildren(tag);\n\n      componentManager.deleteItems(deleteChain);\n    }\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n;angular\n  .module('app')\n  .directive('mbAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('draggable', function() {\n  return  {\n    scope: {\n      tagId: \"=\",\n      drop: '&',\n      isDraggable: \"=\",\n      isDroppable: \"=\"\n    },\n    link: function(scope, element, attrs) {\n      // 'ngInject';\n      var el = element[0];\n\n      el.draggable = scope.isDraggable;\n\n      var counter = 0;\n\n      el.addEventListener(\n        'dragstart',\n        function(e) {\n          counter = 0;\n          e.dataTransfer.effectAllowed = 'move';\n          e.dataTransfer.setData('TagId', JSON.stringify(scope.tagId));\n          this.classList.add('drag');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragend',\n        function(e) {\n          this.classList.remove('drag');\n          this.classList.remove('over');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragover',\n        function(e) {\n          e.dataTransfer.dropEffect = 'move';\n          // allows us to drop\n          if (e.preventDefault) e.preventDefault();\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragenter',\n        function(e) {\n          counter++;\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragleave',\n        function(e) {\n          counter--;\n           if (counter === 0) {\n             this.classList.remove('over');\n           }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragexit',\n        function(e) {\n          // counter--;\n          //  if (counter === 0) {\n             this.classList.remove('over');\n          //  }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'drop',\n        function(e) {\n\n          // Stops some browsers from redirecting.\n          counter = 0;\n          if (e.stopPropagation) e.stopPropagation();\n\n          this.classList.remove('over');\n\n          var targetId = JSON.parse(e.dataTransfer.getData('TagId'));\n          if(targetId === scope.tagId) {\n            return;\n          }\n          scope.$apply(function(scope) {\n            scope.drop()(targetId, scope.tagId);\n          });\n\n          return false;\n        },\n        false\n      );\n\n    }\n  }\n});\n;class TagTree {\n\n  constructor() {\n    this.restrict = \"C\";\n    this.templateUrl = \"directives/tag_tree.html\";\n    this.scope = {\n      tag: \"=\",\n      changeParent: \"&\",\n      onSelect: \"&\",\n      createTag: \"&\",\n      saveTags: \"&\",\n      deleteTag: \"&\",\n      onToggleCollapse: \"&\"\n    };\n  }\n\n  controller($scope, $timeout) {\n    'ngInject';\n\n    $scope.isDraggable = function() {\n      return !$scope.tag.master && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.isDroppable = function() {\n      return !$scope.tag.smartMaster && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.onDrop = function(sourceId, targetId) {\n      $scope.changeParent()(sourceId, targetId);\n    }\n\n    $scope.onDragOver = function(event) {\n\n    }\n\n    $scope.onDragStart = function(event) {\n\n    }\n\n    $scope.selectTag = function(event) {\n      let multiSelect = event.ctrlKey || event.metaKey;\n      $scope.onSelect()($scope.tag, multiSelect);\n    }\n\n    $scope.addChild = function($event, parent) {\n      $event.stopPropagation();\n      var addingTag = {dummy: true, parent: parent, content: {title: \"\"}};\n      parent.children.unshift(addingTag);\n    }\n\n    $scope.saveNewTag = function(tag) {\n      if(tag.content.title && tag.content.title.length > 0) {\n        $scope.createTag()(tag);\n      }\n      tag.parent.children.splice(tag.parent.children.indexOf(tag), 1);\n    }\n\n    $scope.removeTag = function(tag) {\n      $scope.deleteTag()(tag);\n    }\n\n    $scope.innerCollapse = function(tag) {\n      if($scope.onToggleCollapse()) {\n        $scope.onToggleCollapse()(tag);\n      }\n    }\n\n    $scope.saveTagRename = function(tag) {\n      if(!tag.displayTitle || tag.displayTitle.length == 0) {\n        // Delete\n        $scope.deleteTag()(tag);\n        return;\n      }\n      var delimiter = \".\";\n      var tags = [tag];\n      var title;\n      if(tag.parent.master) {\n        title = tag.displayTitle;\n      } else {\n        title = tag.parent.content.title + delimiter + tag.displayTitle;\n      }\n\n      tag.content.title = title;\n\n      function renameChildren(tag) {\n        for(var child of tag.children) {\n          child.content.title = child.parent.content.title + delimiter + child.displayTitle;\n          tags.push(child);\n          renameChildren(child);\n        }\n      }\n\n      renameChildren(tag);\n\n      tag.editing = false;\n\n      $scope.saveTags()(tags);\n    }\n\n    $scope.generationForTag = function(tag) {\n      var generation = 0;\n      var parent = tag.parent;\n      while(parent) {\n        generation++;\n        parent = parent.parent;\n      }\n\n      return generation;\n    }\n\n    $scope.circleClassForTag = function(tag) {\n      if(tag.content_type == \"SN|SmartTag\") {\n        return \"success\";\n      }\n\n      // is newly creating tag\n      if(!tag.uuid) {\n        return \"neutral\";\n      }\n\n\n      let gen = $scope.generationForTag(tag);\n      var circleClass = {\n        0: \"info\",\n        1: \"info\",\n        2: \"success\",\n        3: \"danger\",\n        4: \"warning\",\n      }[gen];\n\n      if(!circleClass) {\n        circleClass = \"neutral\";\n      }\n\n      // Newly creating tags don't have client data\n      if(tag.clientData && tag.clientData.collapsed) {\n        circleClass += \" no-bg\";\n      }\n\n      return circleClass;\n    }\n\n  }\n}\n\nTagTree.$$ngIsClass = true;\n\nangular.module('app').directive('tagTree', () => new TagTree);\n"]}